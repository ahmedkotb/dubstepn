<% content_for :head do %>
  <%= stylesheet_link_tag    "admin" %>
  <%= javascript_include_tag "admin" %>
<% end %>

<% content_for :title, "Admin | Stephan Boyer" %>

<% require 'json' %>

<div>
  <article>
    <h2><a href="/admin">Admin Panel</a></h2>
    <p>
      <%= form_tag("https://www.google.com/analytics/web/?pli=1#report/visitors-overview/a34278795w61806029p63320640/", :method => "get", :style => "display: inline;") do %>
        <button type="submit" class="btn">Google Analytics</button>
      <% end %>
      <%= form_tag("/logout", :method => "post", :style => "display: inline;") do %>
        <button type="submit" class="btn">Log Out</button>
      <% end %>
    </p>

    <h3>Posts</h3>
    <ul id="post_list">
      <% for post in @posts %>
        <li>
          <%= form_tag("/move_up", :method => "post", :style => "display: inline;") do %>
            <input type="hidden" name="post_id" value="<%= post.id -%>" />
            <a href="#" onclick="$(this).parent().submit();"><i class="icon-arrow-up"></i></a>
          <% end %>
          <%= form_tag("/move_down", :method => "post", :style => "display: inline;") do %>
            <input type="hidden" name="post_id" value="<%= post.id -%>" />
            <a href="#" onclick="$(this).parent().submit();"><i class="icon-arrow-down"></i></a>
          <% end %>
          <a href="/edit_post/<%= post.id -%>"><i class="icon-edit"></i></a>
          <a href="#modal_delete_<%= post.id -%>" data-toggle="modal"><i class="icon-trash"></i></a>
          <div id="modal_delete_<%= post.id -%>" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="modal_delete_label_<%= post.id -%>" aria-hidden="true">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
              <h3 id="modal_delete_label_<%= post.id -%>"><%= post.title %></h3>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to delete this post?</p>
            </div>
            <div class="modal-footer">
              <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
              <%= form_tag("/delete_post", :method => "post", :style => "display: inline;") do %>
                <input type="hidden" name="post_id" value="<%= post.id -%>" />
                <button type="submit" class="btn btn-danger">Delete Post</button>
              <% end %>
            </div>
          </div>
          &nbsp;
          <a href="/post/<%= post.id -%>"><%= post.title %></a>
          <%= if post.is_public then "" else raw(" <span class=\"muted\">(hidden)</span>") end %>
        </li>
      <% end %>
    </ul>
    <%= form_tag("/create_post", :method => "post") do %>
      <button type="submit" class="btn">New Post</button>
    <% end %>

    <h3>Tags</h3>
    <ul>
      <% for tag in @tags %>
        <li><a href="/<%= tag.name %>"><%= tag.name %></a></li>
      <% end %>
    </p>
  </article>
</div>

<script>
  var posts = <%= raw(@posts.to_json) %>;
</script>
